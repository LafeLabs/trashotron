<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--

        EVERYTHING IS PHYSICAL 
        EVERYTHING IS FRACTAL
        EVERYTHING IS RECURSIVE
        NO MONEY 
        MO MINING 
        NO PROPERTY
        LOOK AT THE INSECTS
        LOOK AT THE FUNGI
        LANGUAGE IS HOW THE MIND PARSES REALITY

    -->
    
    <link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA/wAAAAD//wAA/wAAAAD/AP8A/wAApv8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFUAAARGAAIxFVUABEYAAjMRFQAARGYiIjMRAABERmZiIzEAAARERGZiMwAAAARERGYiAAAAAABERiL4PwAA+78AAPu/AAD33wAA9V8AAPVfAAD1XwAA998AAOADAADhAAAA4AAAAPAAAADwAAAA+AAAAP4AAAD/wAAA" rel="icon" type="image/x-icon" />
    
    <!--Stop Google:-->
    <META NAME="robots" CONTENT="noindex,nofollow">
<!--geometron javascript library-->
    <script src="jscode/geometron.js"></script>

</head>
<body>
<a id = "readmelink" href  = "readme.html">ABOUT</a>
<br>

<input id  = "actioninput"/>
<table id = "buttontable">
    <tr>
        <td id  = "reload" class = "button">RELOAD!</td>
        <td style = "display:none" id = "deleteme" class = "button">DELETE ME!</td>
        <td id = "nukeitfromorbit" class = "button">NUKE IT FROM ORBIT!(IT'S THE ONLY WAY TO BE SURE)</td>
    </tr>
    <tr>
        <td>NAME:</td>
        <td><input id = "nameinput"/></td>
    </tr>
    <tr>
        <td>LINK:</td>
        <td><input id = "urlinput"/></td>
    </tr>
    <tr>
        <td>MESSAGE:</td>
        <td><input id = "messageinput"/></td>
    </tr>
    <tr>
        <td>GLYPH:</td>
        <td><input id = "glyphinput"/></td>
    </tr>
</table>
<table id = "controltable">
</table>

<div id = "geometronbox">
<canvas id = "maincanvas"></canvas>
<div id = "linkbox"></div>
</div>
<script>


//0305,0350,0362,0203,0334,0334,0203,0334,0334,0334,0203,0334,0334,0203,0363,0334,0334,0334,
shapestack = [
    "0220:0327,0304,0313,0334,0362,0203,0335,0203,0335,0203,0203,0335,0203,0335,0203,0354,0335,0347,"
];


arrow = "0313,0304,0336,0362,0203,0336,0203,0364,0335,0312,0336,0330,0306,0334,0334,0313,0337,0362,0203,0334,0334,0203,0334,0334,0203,0363,0336,0331,0304,0334,0312,0337,0313,0331,0337,0331,0337,0305,0350,";


mytile = {
    "index":0,
    "name":"me",
    "trajectory":"",
    "shape":"0220,",
    "message":"this is geometric social media",
    "url":"https://www.trashrobot.org",
    "relationships":[
    {
        "name":"me",
        "index":0,
        "relationship":"Self"
    }
    ]
};

board = [];
tile1 = JSON.parse(JSON.stringify(mytile));

maincanvas = document.getElementById("maincanvas");

square = 100;
if(innerWidth > innerHeight){
    square = innerHeight;
}
else{
    square = innerWidth;
}

var mainGVM = new GVM(maincanvas,square,square);


//keyboard : asdw, zxcv, jkli uo, colors 1234567 


hypercube05xx = [    
    "0500:0400,0335,0342,0334,0333,",
    "0501:0401,0334,0342,0335,0332,",
    "0502:0402,0326,",
    "0503:0403,0322,",
    "0504:0404,0342,0330,",
    "0505:0405,0331,0342,",
    "0506:0406,0336,",
    "0507:0407,0337,",
    "0510:0350,0334,0201,0335,0304,0410,",
    "0511:0350,0335,0201,0334,0304,0411,",
    "0512:0350,0335,0335,0335,0201,0334,0334,0334,0304,0412,",
    "0513:0350,0334,0334,0334,0201,0335,0335,0335,0304,0413,"    
];

hypercube015xx = [    
    "01500:01400,",
    "01501:01401,",
    "01502:01402,",
    "01503:01403,",
    "01504:01404,",
    "01505:01405,",
    "01506:01406,",
    "01507:01407,",
    "01510:01410,",
    "01511:01411,",
    "01512:01412,",
    "01513:01413,",
"01410:0333,0200,0336,0330,0332,0350,0334,0342,0330,0335,0335,0335,0336,0342,0335,0335,0342,0334,0334,0334,0334,0334,0337,0331,0335,0304,0331,0333,0337,",
    "01411:0333,0200,0336,0330,0332,0350,0335,0201,0335,0335,0335,0336,0342,0335,0335,0342,0335,0335,0335,0337,0331,0334,0304,0331,0333,0337,",
    "01412:0333,0200,0336,0330,0332,0335,0350,0335,0201,0335,0335,0335,0336,0342,0335,0335,0342,0334,0337,0330,0335,0304,0331,0333,0337,",
    "01413:0333,0200,0336,0330,0332,0334,0350,0334,0342,0330,0335,0335,0335,0336,0342,0335,0335,0342,0334,0337,0330,0334,0304,0331,0333,0337,"
];

blankkeyboard = [];
for(var index = 040;index <= 0176;index++){
    blankkeyboard.push("0" + index.toString(8) + ":0177,");    
}
simplekeyboard = [
    "055:0506,",
    "075:0507,",
    "0165:0502,",
    "0151:0504,",
    "0150:0503,",
    "0152:0501,",
    "0153:0505,",
    "0154:0500,",
    "0161:037,",
    "0167:030,",
    "0145:036,",
    "0141:032,",
    "0163:031,",
    "0144:033,",
    "0134:011,",
    "0162:0510,",
    "0164:0511,",
    "0147:0512,",
    "0146:0513,"
];
diagonalkeys = [
    "0145:0510,",
    "0162:0511,",
    "0146:0512,",
    "0144:0513,"
]

  //qwe  "037,030,036,",
//asd    "032,031,033,"

mainGVM.importbytecode(hypercube);
mainGVM.importbytecode(shapestack);
mainGVM.importbytecode(blankkeyboard);
mainGVM.importbytecode(simplekeyboard);
mainGVM.importbytecode(hypercube05xx);
mainGVM.importbytecode(hypercube015xx);

mainGVM.style.line2 = 1;//red
mainGVM.style.fill0 = "#00000040";//green with transparency

mainGVM.style.line6 = 10;//blue
mainGVM.style.fill5 = "#00FF0030";//green with transparency
mainGVM.style.color5 = "#00FF00";//green 
mainGVM.style.line5 = 3;
mainGVM.style.fill7 = "#FF00FF30";//purple with transparency
mainGVM.style.color7 = "#FF00FF";//purple
mainGVM.style.line7= 3
 
myIndex = 0;


var httpboard = new XMLHttpRequest();
httpboard.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        board = JSON.parse(this.responseText);
        board.push(JSON.parse(JSON.stringify(mytile)));
        myIndex = board.length - 1;
        mainGVM.glyph = board[myIndex].trajectory + "0207,";
        document.getElementById("nameinput").value = board[myIndex].name;
        document.getElementById("urlinput").value = board[myIndex].url;
        document.getElementById("messageinput").value = board[myIndex].message;

        drawmain();

    }
};
httpboard.open("GET", "fileloader.php?filename=data/board.txt", true);
httpboard.send();        


document.getElementById("nameinput").onchange = function(){
    board[myIndex].name = this.value;
    updateboard();
    drawmain();
}
document.getElementById("urlinput").onchange = function(){
    board[myIndex].url = this.value;
    updateboard();
    drawmain();    
}

document.getElementById("messageinput").onchange = function(){
    board[myIndex].message = this.value;
    updateboard();
    drawmain();    
}



function drawmain(){
    document.getElementById("linkbox").innerHTML = "";
    mainGVM.drawGlyph("0300,0325,0347,0342,0335,0342,0335,0342,0335,0342,0335,");
    for(var index = 0;index < board.length;index++){
        if(index != myIndex){
            mainGVM.actionSequence("0300,");
            mainGVM.actionSequence(board[index].trajectory);
            mainGVM.actionSequence("0320,0304,0313,0334,0362,0203,0335,0203,0335,0203,0203,0335,0203,0335,0203,0354,0335,0347,");
            board[index].x = mainGVM.x;
            board[index].y = mainGVM.y;
            board[index].side = mainGVM.side;
            if(board[index].side > 100){
                var newa = document.createElement("A");
                newa.href = board[index].url;
                newa.innerHTML = board[index].name;
                newa.style.left = board[index].x.toString() + "px";
                newa.style.top = board[index].y.toString() + "px";
                document.getElementById("linkbox").appendChild(newa);
            }
            if(board[index].side > 200){
                var newspan = document.createElement("SPAN");
                newspan.innerHTML = board[index].trajectory;
                newspan.style.left = board[index].x.toString() + "px";
                newspan.style.top = (board[index].y - 50).toString() + "px";
                document.getElementById("linkbox").appendChild(newspan);
                var newspan = document.createElement("SPAN");
                newspan.innerHTML = board[index].message;
                newspan.style.left = board[index].x.toString() + "px";
                newspan.style.top = (board[index].y + 50).toString() + "px";
                document.getElementById("linkbox").appendChild(newspan);
        
            }
            
        }
    }
    mainGVM.actionSequence("0300,");
    mainGVM.actionSequence(board[myIndex].trajectory);
    document.getElementById("glyphinput").value = board[myIndex].trajectory;
    mainGVM.actionSequence(board[myIndex].shape);
    board[myIndex].x = mainGVM.x;
    board[myIndex].y = mainGVM.y;
    board[myIndex].side = mainGVM.side;
    if(board[myIndex].side > 100){
        var newa = document.createElement("A");
        newa.href = board[myIndex].url;
        newa.innerHTML = board[myIndex].name;
        newa.style.left = board[myIndex].x.toString() + "px";
        newa.style.top = board[myIndex].y.toString() + "px";
        document.getElementById("linkbox").appendChild(newa);
    }
    if(board[myIndex].side > 200){
        var newspan = document.createElement("SPAN");
        newspan.innerHTML = board[index].trajectory;
        newspan.style.left = board[myIndex].x.toString() + "px";
        newspan.style.top = (board[myIndex].y - 50).toString() + "px";
        document.getElementById("linkbox").appendChild(newspan);
    }

    
}


document.getElementById("actioninput").onkeypress = function(a) {
    var charCode = a.keyCode || a.which;
    localCursorAction = parseInt(mainGVM.hypercube[charCode],8);   
    mainGVM.cursorAction(localCursorAction);   
    this.value = "";
    mainGVM.clean();
    board[myIndex].trajectory = mainGVM.cleanGlyph;
    drawmain();
    updateboard();

}


document.getElementById("actioninput").onkeydown = function(a) {
    var charCode = a.keyCode || a.which;

    //console.log(charCode.toString(8));

    if(charCode == 010) {
        mainGVM.cursorAction(010);
    }

    if(charCode == 046) {
//        console.log("up arrow");
        updateboard();

        myIndex--;
        if(myIndex<0){
            myIndex = board.length -1;
        }
        mainGVM.glyph = board[myIndex].trajectory + "0207,";
        document.getElementById("nameinput").value = board[myIndex].name;
        document.getElementById("urlinput").value = board[myIndex].url;
        document.getElementById("messageinput").value = board[myIndex].message;

    }
    if(charCode == 050) {
  //      console.log("down arrow");
         updateboard();

         myIndex++;
         if(myIndex> board.length-1){
             myIndex =0;
         }
        mainGVM.glyph = board[myIndex].trajectory + "0207,";
        document.getElementById("nameinput").value = board[myIndex].name;
        document.getElementById("urlinput").value = board[myIndex].url;
        document.getElementById("messageinput").value = board[myIndex].message;

        
    }

    if(charCode == 0116){
        // letter n
        
        var httpboard = new XMLHttpRequest();
        httpboard.onreadystatechange = function(){
            if (this.readyState == 4 && this.status == 200) {
                board = JSON.parse(this.responseText);
                board.push(JSON.parse(JSON.stringify(mytile)));
                myIndex = board.length - 1;
                mainGVM.glyph = board[myIndex].trajectory + "0207,";
                document.getElementById("nameinput").value = board[myIndex].name;
                document.getElementById("urlinput").value = board[myIndex].url;
                document.getElementById("messageinput").value = board[myIndex].message;
        
                drawmain();
        
            }
        };
        httpboard.open("GET", "fileloader.php?filename=data/board.txt", true);
        httpboard.send();        
    }

    mainGVM.clean();
    board[myIndex].trajectory = mainGVM.cleanGlyph;
    drawmain();
    updateboard();
}

if(innerWidth > innerHeight){
    document.getElementById("actioninput").select();
}



topcontrols  = [
    "0506,0504,0507,011,",
    "0501,010,0500,0510,",
    "0502,0505,0503,0511,",
    "037,030,036,0512,",
    "032,031,033,0513,"
];


controlbuttonsize = 80;

document.getElementById("controltable").innerHTML = "";
for(var index = 0;index < topcontrols.length;index++){
    var newtr = document.createElement("TR");
    document.getElementById("controltable").appendChild(newtr);
    rowarray = topcontrols[index].split(",");
    for(var rowindex = 0;rowindex < rowarray.length;rowindex++){
        if(rowarray[rowindex].length > 0){
            var newtd = document.createElement("TD");
            newtr.appendChild(newtd);
            var newcan = document.createElement("CANVAS");
            newtd.appendChild(newcan);
            var datadiv = document.createElement("div");
            datadiv.innerHTML = rowarray[rowindex];
            datadiv.className = "data";
            newtd.appendChild(datadiv);
            var newGVM = new GVM(newcan,controlbuttonsize,controlbuttonsize);
            newGVM.unit = controlbuttonsize - 2;
            newGVM.x0 = 1;
            newGVM.y0 = controlbuttonsize-1;
            newGVM.importbytecode(hypercube);
            newGVM.importbytecode(shapestack);
            newGVM.importbytecode(hypercube015xx);

            newGVM.action(0300);
            if(parseInt(rowarray[rowindex],8) >= 040 && parseInt(rowarray[rowindex],8) < 0177){
                newGVM.drawGlyph("0300,0336,0336,0330,0333,0337,");
            }
            newGVM.action(parseInt(rowarray[rowindex],8)+01000);

            newtd.onclick = function(){
                var localaction = parseInt(this.getElementsByClassName("data")[0].innerHTML,8);
                if(localaction != 022 && localaction != 023){
                    if(localaction >= 040 && localaction < 0177){
                        localaction += 01000;
                    }
                    mainGVM.cursorAction(localaction);
                }
                if(localaction == 022){
                    previous();
                }
                if(localaction == 023){
                    next();
                }
                                                    
                mainGVM.clean();
                board[myIndex].trajectory = mainGVM.cleanGlyph;
                updateboard();
                drawmain();


            }
            newcan.classList.add("button");
        }
    }
}


document.getElementById("reload").onclick = function(){
     location.reload(); 
}

document.getElementById("nukeitfromorbit").onclick = function(){
    board = [];
    board.push(JSON.parse(JSON.stringify(mytile)));
    var url = "filesaver.php";        
    var httpc = new XMLHttpRequest();
    httpc.open("POST", url, true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpc.send("data="+encodeURIComponent(JSON.stringify(board,null,"    "))+"&filename=data/board.txt");//send text to filesaver.php      
    myIndex = 0;
    board[myIndex].trajectory = "";
    drawmain();
    if(innerWidth>innerHeight){
        document.getElementById("actioninput").select();
    }
}

function updateboard(){
    var httpboard = new XMLHttpRequest();
    httpboard.onreadystatechange = function(){
        if (this.readyState == 4 && this.status == 200) {
            oldboard = JSON.parse(this.responseText);
            oldboard[myIndex] = board[myIndex];
            board = oldboard;
            for(index = 0;index < board.length;index++){
                board[index].index = index;
            }
            var url = "filesaver.php";        
            var httpc = new XMLHttpRequest();
            httpc.open("POST", url, true);
            httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            httpc.send("data="+encodeURIComponent(JSON.stringify(board,null,"    "))+"&filename=data/board.txt");//send text to filesaver.php            
        }
    };
    httpboard.open("GET", "fileloader.php?filename=data/board.txt", true);
    httpboard.send();        
}


function deleteme(){
    var httpboard = new XMLHttpRequest();
    httpboard.onreadystatechange = function(){
        if (this.readyState == 4 && this.status == 200) {
            oldboard = JSON.parse(this.responseText);
            board = [];
            myIndex = 0;
            for(var index= 0;index < oldboard.length;index++){
                if(index != myIndex){
                    board.push(oldboard[index]);
                }    
            }
            for(index = 0;index < board.length;index++){
                board[index].index = index;
            }
            document.getElementById("actioninput").style.display = "none";
            document.getElementById("bottomtable").style.display = "none";
document.getElementById("bottomtable").innerHTML = "";

            var url = "filesaver.php";        
            var httpc = new XMLHttpRequest();
            httpc.open("POST", url, true);
            httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            httpc.send("data="+encodeURIComponent(JSON.stringify(board,null,"    "))+"&filename=data/board.txt");//send text to filesaver.php            
            mainGVM.drawGlyph("0300,");
            for(var index = 0;index < board.length;index++){
                mainGVM.actionSequence("0300,");
                mainGVM.actionSequence(board[index].trajectory);
                mainGVM.actionSequence(board[index].shape);
            }
            

        }
    };
    httpboard.open("GET", "fileloader.php?filename=data/board.txt", true);
    httpboard.send();        
}
document.getElementById("deleteme").onclick = function(){
    //delete me!
    deleteme();
}

</script>
<style>
body{
    overflow:hidden;
    background-color:#9f8767;
    font-family:Comic Sans MS;

    
}
#readmelink{
    position:absolute;
    right:10px;
    top:10px;
    color:#0000ff;
}
#geometronbox{
    position:absolute;
    right:0px;
    top:0px;
    z-index:-1;
}
#linkbox{
    position:absolute;
    left:0px;
    top:0px;
    width:100%;
    height:100%;
    overflow:none;
}
#linkbox a{
    position:absolute;
    border:solid;
    z-index:2;
}
#linkbox span{
    position:absolute;
    border:solid;
    z-index:1;
}

#buttontable td{
    border:solid;
    text-align:center;
    border-radius:5px;
}
#controltable{
    position:absolute;
    left:0px;
    bottom:0px;
}
.button{
    cursor:pointer;
}
.button:hover{
    background-color:green;
}
.button:active{
    background-color:yellow;
}
.data{
    display:none;
}
#actioninput{
    width:10px;
}
@media only screen and (orientation: portrait) {
    #actioninput{
        display:none;
    }
}
</style>
</body>
</html>